<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gooalgene.dna.dao.DNARunDao">
    <cache eviction="FIFO" flushInterval="600000" size="1024" readOnly="true" />

    <resultMap id="BaseResultMap" type="com.gooalgene.dna.entity.DNARun" >
        <id column="id" property="id" jdbcType="INTEGER" />
        <result column="run_no" property="runNo" jdbcType="VARCHAR" />
        <result column="species" property="species" jdbcType="VARCHAR" />
        <result column="sample_name" property="sampleName" jdbcType="VARCHAR" />
        <result column="cultivar" property="cultivar" jdbcType="VARCHAR" />
        <result column="plant_name" property="plantName" jdbcType="VARCHAR" />
        <result column="locality" property="locality" jdbcType="VARCHAR" />
        <result column="protein" property="protein" jdbcType="REAL" />
        <result column="oil" property="oil" jdbcType="REAL" />
        <result column="linoleic" property="linoleic" jdbcType="REAL" />
        <result column="linolenic" property="linolenic" jdbcType="REAL" />
        <result column="oleic" property="oleic" jdbcType="REAL" />
        <result column="palmitic" property="palmitic" jdbcType="REAL" />
        <result column="stearic" property="stearic" jdbcType="REAL" />
        <result column="height" property="height" jdbcType="DOUBLE"/>
        <result column="flower_color" property="flowerColor" jdbcType="VARCHAR" />
        <result column="hilum_color" property="hilumColor" jdbcType="VARCHAR" />
        <result column="pod_color" property="podColor" jdbcType="VARCHAR" />
        <result column="pubescence_color" property="pubescenceColor" jdbcType="VARCHAR" />
        <result column="seed_coat_color" property="seedCoatColor" jdbcType="VARCHAR" />
        <result column="cotyledon_color" property="cotyledonColor" jdbcType="VARCHAR" />
        <result column="weight_per_100seeds" property="weightPer100seeds" jdbcType="REAL" />
        <result column="upper_leaflet_length" property="upperLeafletLength" jdbcType="REAL" />
        <result column="maturity_date" property="maturityDate" jdbcType="VARCHAR" />
        <result column="yield" property="yield" jdbcType="REAL" />
        <result column="category" property="group" jdbcType="VARCHAR" />
    </resultMap>
    <!--<resultMap id="HandlerResultMap" type="com.gooalgene.dna.entity.result.DNARunSearchResult" >
        <id column="id" property="id" jdbcType="INTEGER" />
        <result column="run_no" property="runNo" jdbcType="VARCHAR" typeHandler="com.gooalgene.dna.util.StringlToNullHandler" />
        <result column="species" property="species" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="sample_name" property="sampleName" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="cultivar" property="cultivar" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="plant_name" property="plantName" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="locality" property="locality" jdbcType="VARCHAR" typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="protein" property="protein" jdbcType="DOUBLE" typeHandler="com.gooalgene.dna.util.ZeroDecimalToNullHandler" />
        <result column="oil" property="oil" jdbcType="DOUBLE" typeHandler="com.gooalgene.dna.util.ZeroDecimalToNullHandler"  />
        <result column="linoleic" property="linoleic" jdbcType="DOUBLE" typeHandler="com.gooalgene.dna.util.ZeroDecimalToNullHandler" />
        <result column="linolenic" property="linolenic" jdbcType="DOUBLE" typeHandler="com.gooalgene.dna.util.ZeroDecimalToNullHandler"  />
        <result column="oleic" property="oleic" jdbcType="DOUBLE" typeHandler="com.gooalgene.dna.util.ZeroDecimalToNullHandler"/>
        <result column="palmitic" property="palmitic" jdbcType="DOUBLE" typeHandler="com.gooalgene.dna.util.ZeroDecimalToNullHandler" />
        <result column="stearic" property="stearic" jdbcType="DOUBLE" typeHandler="com.gooalgene.dna.util.ZeroDecimalToNullHandler"/>
        <result column="height" property="height" jdbcType="DOUBLE" typeHandler="com.gooalgene.dna.util.ZeroDecimalToNullHandler"/>
        <result column="flower_color" property="flowerColor" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="hilum_color" property="hilumColor" jdbcType="VARCHAR" typeHandler="com.gooalgene.dna.util.StringlToNullHandler" />
        <result column="pod_color" property="podColor" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="pubescence_color" property="pubescenceColor" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="seed_coat_color" property="seedCoatColor" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="cotyledon_color" property="cotyledonColor" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="weight_per_100seeds" property="weightPer100seeds" jdbcType="DOUBLE"  typeHandler="com.gooalgene.dna.util.ZeroDecimalToNullHandler"/>
        <result column="upper_leaflet_length" property="upperLeafletLength" jdbcType="DOUBLE"  typeHandler="com.gooalgene.dna.util.ZeroDecimalToNullHandler"/>
        <result column="maturity_date" property="maturityDate" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="yield" property="yield" jdbcType="DOUBLE"  typeHandler="com.gooalgene.dna.util.ZeroDecimalToNullHandler"/>
        <result column="category" property="group" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
    </resultMap>-->

    <sql id="Base_Column_List" >
        id, run_no, species, sample_name, cultivar, plant_name, locality, protein, oil, linoleic,
        linolenic, oleic, palmitic, stearic, height, flower_color, hilum_color, pod_color,
        pubescence_color, seed_coat_color, cotyledon_color, weight_per_100seeds, upper_leaflet_length,
        maturity_date, yield, category
    </sql>

    <sql id="Example_Where_Clause" >
        <where >
            <foreach collection="oredCriteria" item="criteria" separator="or" >
                <if test="criteria.valid" >
                    <trim prefix="(" suffix=")" prefixOverrides="and" >
                        <foreach collection="criteria.criteria" item="criterion" >
                            <choose >
                                <when test="criterion.noValue" >
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue" >
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue" >
                                    and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue" >
                                    and ${criterion.condition}
                                    <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>

    <select id="get" resultType="com.gooalgene.dna.entity.DNARun">
        SELECT * from dna_run where id=#{id}
    </select>

    <delete id="deleteById" parameterType="int">
        DELETE FROM dna_run WHERE id=#{id}
    </delete>

    <insert id="insertBatch">
        INSERT INTO `dna_run`(`run_no`,`species`,`sample_name`,`cultivar`,`plant_name`,`locality`,
        `protein`,`oil`,`linoleic`,`linolenic`,`oleic`,`palmitic`,`stearic`,`height`,
        `flower_color`,`hilum_color`,`pod_color`,`pubescence_color`,`seed_coat_color`,`cotyledon_color`,
        `weight_per_100seeds`,`upper_leaflet_length`,`maturity_date`,`yield`, `category`)
        VALUES
        <foreach collection="list" item="item" index="index" separator=",">
            (#{item.runNo,jdbcType=VARCHAR},#{item.species,jdbcType=VARCHAR},#{item.sampleName,jdbcType=VARCHAR},#{item.cultivar,jdbcType=VARCHAR},#{item.plantName,jdbcType=VARCHAR},#{item.locality,jdbcType=VARCHAR},
            #{item.protein,jdbcType=FLOAT},#{item.oil,jdbcType=FLOAT},#{item.linoleic,jdbcType=FLOAT},#{item.linolenic,jdbcType=FLOAT},#{item.oleic,jdbcType=FLOAT},#{item.palmitic,jdbcType=FLOAT},#{item.stearic,jdbcType=FLOAT},#{item.height,jdbcType=FLOAT},
            #{item.flowerColor,jdbcType=VARCHAR},#{item.hilumColor,jdbcType=VARCHAR},#{item.podColor,jdbcType=VARCHAR},#{item.pubescenceColor,jdbcType=VARCHAR},#{item.seedCoatColor,jdbcType=VARCHAR},#{item.cotyledonColor,jdbcType=VARCHAR},
            #{item.weightPer100seeds,jdbcType=FLOAT},#{item.upperLeafletLength,jdbcType=FLOAT},
            #{item.maturityDate,jdbcType=VARCHAR},#{item.yield,jdbcType=FLOAT},#{item.group,jdbcType=VARCHAR})
        </foreach>
    </insert>

    <insert id="insert" parameterType="com.gooalgene.dna.entity.DNARun">
        INSERT INTO `dna_run`(`run_no`,`species`,`sample_name`,`cultivar`,`plant_name`,`locality`,
        `protein`,`oil`,`linoleic`,`linolenic`,`oleic`,`palmitic`,`stearic`,`height`,
        `flower_color`,`hilum_color`,`pod_color`,`pubescence_color`,`seed_coat_color`,`cotyledon_color`,
        `weight_per_100seeds`,`upper_leaflet_length`,
        `flowering_date`,`maturity_date`,`yield`)
        VALUES (#{runNo,jdbcType=VARCHAR},#{species,jdbcType=VARCHAR},#{sampleName,jdbcType=VARCHAR},#{cultivar,jdbcType=VARCHAR},#{plantName,jdbcType=VARCHAR},#{locality,jdbcType=VARCHAR},
        #{protein,jdbcType=FLOAT},#{oil,jdbcType=FLOAT},#{linoleic,jdbcType=FLOAT},#{linolenic,jdbcType=FLOAT},#{oleic,jdbcType=FLOAT},#{palmitic,jdbcType=FLOAT},#{stearic,jdbcType=FLOAT},#{height,jdbcType=FLOAT},
        #{flowerColor,jdbcType=VARCHAR},#{hilumColor,jdbcType=VARCHAR},#{podColor,jdbcType=VARCHAR},#{pubescenceColor,jdbcType=VARCHAR},#{seedCoatColor,jdbcType=VARCHAR},#{cotyledonColor,jdbcType=VARCHAR},
        #{weightPer100seeds,jdbcType=FLOAT},#{upperLeafletLength,jdbcType=FLOAT},
        #{floweringDate,jdbcType=VARCHAR},#{maturityDate,jdbcType=VARCHAR},
        #{yield,jdbcType=FLOAT})
    </insert>
    <select id="getListByCondition" resultMap="BaseResultMap" parameterType="com.gooalgene.dna.dto.DnaRunDto">
        select
        <include refid="Base_Column_List" />
        from dna_run
        <trim prefix="where" prefixOverrides="and|or">
            <if test="runNo!=null and runNo!=''">
                AND run_no like CONCAT('%',#{runNo},'%' )
            </if>
            <if test="species!=null and species!=''">
                AND species like CONCAT('%',#{species},'%' )
            </if>
            <if test="sampleName!=null and sampleName!=''">
                AND sample_name like CONCAT('%',#{sampleName},'%' )
            </if>
            <if test="cultivar!=null and cultivar!=''">
                AND cultivar like CONCAT('%',#{cultivar},'%' )
            </if>
            <if test="plantName!=null and plantName!=''">
                AND plant_name like CONCAT('%',#{plantName},'%' )
            </if>
            <if test="locality!=null and locality!=''">
                AND locality like CONCAT('%',#{locality},'%' )
            </if>
            <if test="protein_min!=null and protein_max!=null">
                AND (protein BETWEEN #{protein_min} AND #{protein_max})
            </if>
            <if test="oil_min!=null and oil_max!=null">
                AND (oil BETWEEN #{oil_min} AND #{oil_max})
            </if>
            <if test="linoleic_min!=null and linoleic_max!=null">
                AND (linoleic BETWEEN #{linoleic_min} AND #{linoleic_max})
            </if>
            <if test="linolenic_min!=null and linolenic_max!=null">
                AND (linolenic BETWEEN #{linolenic_min} AND #{linolenic_max})
            </if>

            <if test="oleic_min!=null and oleic_max!=null">
                AND (oleic BETWEEN #{oleic_min} AND #{oleic_max})
            </if>
            <if test="palmitic_min!=null and palmitic_max!=null">
                AND (palmitic BETWEEN #{palmitic_min} AND #{palmitic_max})
            </if>

            <if test="stearic_min!=null and stearic_max!=null">
                AND (stearic BETWEEN #{stearic_min} AND #{stearic_max})
            </if>
            <if test="height_min!=null and height_max!=null">
                AND (height BETWEEN #{height_min} AND #{height_max})
            </if>
            <if test="flowerColor!=null and flowerColor!=''">
                AND flower_color like CONCAT('%',#{flowerColor},'%')
            </if>
            <if test="hilumColor!=null and hilumColor!=''">
                AND hilum_color like CONCAT('%',#{hilumColor},'%')
            </if>
            <if test="podColor!=null and podColor!=''">
                AND pod_color like CONCAT('%',#{podColor},'%')
            </if>
            <if test="pubescenceColor!=null and pubescenceColor!=''">
                AND pubescence_color like CONCAT('%',#{pubescenceColor},'%')
            </if>
            <if test="seedCoatColor!=null and seedCoatColor!=''">
                AND seed_coat_color like CONCAT('%',#{seedCoatColor},'%')
            </if>
            <if test="cotyledonColor!=null and cotyledonColor!=''">
                AND cotyledon_color like CONCAT('%',#{cotyledonColor},'%')
            </if>
            <if test="pubescenceColor!=null and pubescenceColor!=''">
                AND pubescence_color like CONCAT('%',#{pubescenceColor},'%')
            </if>

            <if test="weightPer100seeds_min!=null and weightPer100seeds_max!=null">
                AND (weight_per_100seeds BETWEEN #{weightPer100seeds_min} AND #{weightPer100seeds_max})
            </if>
            <if test="upperLeafletLength_min!=null and upperLeafletLength_max!=null">
                AND (upper_leaflet_length BETWEEN #{upperLeafletLength_min} AND #{upperLeafletLength_max})
            </if>

            <if test="floweringDate!=null and floweringDate!=''">
                AND flowering_date like CONCAT('%',#{floweringDate},'%')
            </if>
            <if test="maturityDate!=null and maturityDate!=''">
                <choose>
                    <when test="maturityDate!='0'.toString()">
                        AND maturity_date REGEXP CONCAT('^',#{maturityDate},' -')
                    </when>
                    <when test="maturityDate=='0'.toString()">
                        AND maturity_date like CONCAT('',#{maturityDate},'%')
                    </when>
                </choose>
            </if>

            <if test="yield_min!=null and yield_max!=null">
                AND (yield BETWEEN #{yield_min} AND #{yield_max})
            </if>
            <if test="group!=null and group!=''">
                AND category =#{group}
            </if>
        </trim>
    </select>

    <select id="getListByConditionWithTypeHandler" resultMap="HandlerResultMap" parameterType="com.gooalgene.dna.entity.SampleInfo">
        select
        <include refid="Base_Column_List" />
        from dna_run
        <trim prefix="where" prefixOverrides="and|or">
            <if test="runNos!=null and runNos.size>0">
                AND run_no IN
                <foreach collection="runNos" item="runNo" open="(" close=")" separator=",">
                    #{runNo}
                </foreach>
            </if>
            <if test="runNo!=null and runNo!=''">
                AND run_no like CONCAT('%',#{runNo},'%' )
            </if>
            <if test="scientificName!=null and scientificName!=''">
                AND scientific_name like CONCAT('%',#{scientificName},'%' )
            </if>
            <if test="sampleId!=null and sampleId!=''">
                AND sample_id like CONCAT('%',#{sampleId},'%' )
            </if>
            <if test="strainName!=null and strainName!=''">
                AND strain_name like CONCAT('%',#{strainName},'%' )
            </if>
            <if test="preservationLocation!=null and preservationLocation!=''">
                AND preservation_location like CONCAT('%',#{preservationLocation},'%' )
            </if>
            <if test="locality!=null and locality!=''">
                AND locality like CONCAT('%',#{locality},'%' )
            </if>
            <if test="type!=null and type!=''">
                AND type like CONCAT('%',#{type},'%')
            </if>
            <if test="environment!=null and environment!=''">
                AND environment like CONCAT('%',#{environment},'%')
            </if>
            <if test="materials!=null and materials!=''">
                AND materials like CONCAT('%',#{materials},'%')
            </if>
            <if test="treat!=null and treat!=''">
                AND treat like CONCAT('%',#{treat},'%')
            </if>
            <if test="definitionTime!=null and definitionTime!=''">
                AND definition_time like CONCAT('%',#{definitionTime},'%')
            </if>
            <if test="taxonomy!=null and taxonomy!=''">
                AND taxonomy like CONCAT('%',#{taxonomy},'%')
            </if>
            <if test="myceliaPhenotype!=null and myceliaPhenotype!=''">
                AND mycelia_phenotype like CONCAT('%',#{myceliaPhenotype},'%')
            </if>
            <if test="myceliaDiameter!=null and myceliaDiameter!=''">
                AND mycelia_diameter like CONCAT('%',#{myceliaDiameter},'%')
            </if>
            <if test="myceliaColor!=null and myceliaColor!=''">
                AND mycelia_color like CONCAT('%',#{myceliaColor},'%')
            </if>
            <if test="sporesColor!=null and sporesColor!=''">
                AND spores_color like CONCAT('%',#{sporesColor},'%')
            </if>
            <if test="sporesShape!=null and sporesShape!=''">
                AND spores_shape like CONCAT('%',#{sporesShape},'%')
            </if>
            <if test="clampConnection!=null and clampConnection!=''">
                AND clamp_connection like CONCAT('%',#{clampConnection},'%')
            </if>
            <if test="pileusPhenotype!=null and pileusPhenotype!=''">
                AND pileus_phenotype like CONCAT('%',#{pileusPhenotype},'%')
            </if>
            <if test="pileusColor!=null and pileusColor!=''">
                AND pileus_color like CONCAT('%',#{pileusColor},'%')
            </if>
            <if test="stipePhenotype!=null and stipePhenotype!=''">
                AND stipe_phenotype like CONCAT('%',#{stipePhenotype},'%')
            </if>
            <if test="stipeColor!=null and stipeColor!=''">
                AND stipe_color like CONCAT('%',#{stipeColor},'%')
            </if>
            <if test="fruitbodyColor!=null and fruitbodyColor!=''">
                AND fruitbody_color like CONCAT('%',#{fruitbodyColor},'%')
            </if>
            <if test="fruitbodyType!=null and fruitbodyType!=''">
                AND fruitbody_type like CONCAT('%',#{fruitbodyType},'%')
            </if>
            <if test="illumination!=null and illumination!=''">
                AND illumination like CONCAT('%',#{illumination},'%')
            </if>
            <if test="collarium!=null and collarium!=''">
                AND collarium like CONCAT('%',#{collarium},'%')
            </if>
            <if test="volva!=null and volva!=''">
                AND volva like CONCAT('%',#{volva},'%')
            </if>
            <if test="velum!=null and velum!=''">
                AND velum like CONCAT('%',#{velum},'%')
            </if>
            <if test="sclerotium!=null and sclerotium!=''">
                AND volva like CONCAT('%',#{volva},'%')
            </if>
            <if test="strainMedium!=null and strainMedium!=''">
                AND strain_medium like CONCAT('%',#{strainMedium},'%')
            </if>
            <if test="mainSubstrate!=null and mainSubstrate!=''">
                AND main_substrate like CONCAT('%',#{mainSubstrate},'%')
            </if>
            <if test="afterRipeningStage!=null and afterRipeningStage!=''">
                AND after_ripening_stage like CONCAT('%',#{afterRipeningStage},'%')
            </if>
            <if test="primordialStimulationFruitbody!=null and primordialStimulationFruitbody!=''">
                AND primordial_stimulation_fruitbody like CONCAT('%',#{primordialStimulationFruitbody},'%')
            </if>
            <if test="reproductiveMode!=null and reproductiveMode!=''">
                AND reproductive_mode like CONCAT('%',#{reproductiveMode},'%')
            </if>
            <if test="lifestyle!=null and lifestyle!=''">
                AND lifestyle like CONCAT('%',#{lifestyle},'%')
            </if>
            <if test="preservation!=null and preservation!=''">
                AND preservation like CONCAT('%',#{preservation},'%')
            </if>
            <if test="domestication!=null and domestication!=''">
                AND domestication like CONCAT('%',#{domestication},'%')
            </if>
            <if test="nuclearPhase!=null and nuclearPhase!=''">
                AND nuclear_phase like CONCAT('%',#{nuclearPhase},'%')
            </if>
            <if test="matingType!=null and matingType!=''">
                AND mating_type like CONCAT('%',#{matingType},'%')
            </if>
        </trim>
    </select>

    <select id="findList" resultType="com.gooalgene.dna.entity.DNARun">
        SELECT * from dna_run
        WHERE 1=1
        <if test="keywords!=null">
            AND (
            run_no LIKE CONCAT('%',#{keywords},'%') OR species LIKE CONCAT('%',#{keywords},'%') OR sample_name LIKE CONCAT('%',#{keywords},'%') OR cultivar LIKE CONCAT('%',#{keywords},'%') OR
            plant_name LIKE CONCAT('%',#{keywords},'%') OR locality LIKE CONCAT('%',#{keywords},'%') OR protein LIKE CONCAT('%',#{keywords},'%') OR oil LIKE CONCAT('%',#{keywords},'%') OR
            linoleic LIKE CONCAT('%',#{keywords},'%') OR linolenic LIKE CONCAT('%',#{keywords},'%') OR oleic LIKE CONCAT('%',#{keywords},'%') OR palmitic LIKE CONCAT('%',#{keywords},'%') OR
            stearic LIKE CONCAT('%',#{keywords},'%') OR height LIKE CONCAT('%',#{keywords},'%') OR flower_color LIKE CONCAT('%',#{keywords},'%') OR hilum_color LIKE CONCAT('%',#{keywords},'%') OR
            pod_color LIKE CONCAT('%',#{keywords},'%') OR pubescence_color LIKE CONCAT('%',#{keywords},'%') OR seed_coat_color LIKE CONCAT('%',#{keywords},'%') OR cotyledon_color LIKE CONCAT('%',#{keywords},'%') OR
            weight_per_100seeds LIKE CONCAT('%',#{keywords},'%') OR upper_leaflet_length LIKE CONCAT('%',#{keywords},'%') OR
            maturity_date LIKE CONCAT('%',#{keywords},'%') OR yield LIKE CONCAT('%',#{keywords},'%') OR category LIKE concat('%',#{group},'%')
            )
        </if>
        <if test="species!=null">
            AND species = #{species}
        </if>
        <if test="locality!=null">
            <choose>
                <when test="locality=='Other'">
                    AND locality NOT REGEXP 'China|United States|Japan|Korea|Brazil'
                </when>
                <otherwise>
                    AND locality LIKE CONCAT('%',#{locality},'%')
                </otherwise>
            </choose>
        </if>
        <if test="maturityDate!=null">
            AND maturity_date LIKE CONCAT('',#{maturityDate},'%')
        </if>
        <if test="hilumColor!=null">
            AND hilum_color = #{hilumColor}
        </if>
        <if test="flowerColor!=null">
            AND flower_color = #{flowerColor}
        </if>
        <if test="podColor!=null">
            AND pod_color = #{podColor}
        </if>
        <if test="pubescenceColor!=null">
            AND pubescence_color =#{pubescenceColor}
        </if>
        <if test="seedCoatColor!=null">
            AND seed_coat_color =#{seedCoatColor}
        </if>
        <if test="cotyledonColor!=null">
            AND cotyledon_color = #{cotyledonColor}
        </if>
        <if test="protein_min!=null and protein_max!=null">
            AND (protein BETWEEN #{protein_min} AND #{protein_max})
        </if>
        <if test="oil_min!=null and oil_max!=null">
            AND (oil BETWEEN #{oil_min} AND #{oil_max})
        </if>
        <if test="linoleic_min!=null and linoleic_max!=null">
            AND (linoleic BETWEEN #{linoleic_min} AND #{linoleic_max})
        </if>
        <if test="linolenic_min!=null and linolenic_max!=null">
            AND (linolenic BETWEEN #{linolenic_min} AND #{linolenic_max})
        </if>
        <if test="oleic_min!=null and oleic_max!=null">
            AND (oleic BETWEEN #{oleic_min} AND #{oleic_max})
        </if>
        <if test="palmitic_min!=null and palmitic_max!=null">
            AND (palmitic BETWEEN #{palmitic_min} AND #{palmitic_max})
        </if>
        <if test="stearic_min!=null and stearic_max!=null">
            AND (stearic BETWEEN #{stearic_min} AND #{stearic_max})
        </if>
        <if test="height_min!=null and height_max!=null">
            AND (height BETWEEN #{height_min} AND #{height_max})
        </if>
        <if test="weightPer100seeds_min!=null and weightPer100seeds_max!=null">
            AND (weight_per_100seeds BETWEEN #{weightPer100seeds_min} AND #{weightPer100seeds_max})
        </if>
        <if test="upperLeafletLength_min!=null and upperLeafletLength_max!=null">
            AND (upper_leaflet_length BETWEEN #{upperLeafletLength_min} AND #{upperLeafletLength_max})
        </if>
        <if test="yield_min!=null and yield_max!=null">
            AND (yield BETWEEN #{yield_min} AND #{yield_max})
        </if>
        <if test="group!=null">
            AND category = #{group}
        </if>
        <if test="cultivar!=null">
            AND cultivar=#{cultivar}
        </if>
        <if test="sampleName!=null">
            AND sample_name=#{sampleName}
        </if>
    </select>

    <!--<select id="findListWithTypeHandler" resultMap="HandlerResultMap" parameterType="com.gooalgene.dna.dto.DnaRunDto">
        SELECT * from dna_run
        WHERE 1=1
        <if test="keywords!=null">
            AND (
            run_no LIKE CONCAT('%',#{keywords},'%') OR species LIKE CONCAT('%',#{keywords},'%') OR sample_name LIKE CONCAT('%',#{keywords},'%') OR cultivar LIKE CONCAT('%',#{keywords},'%') OR
            plant_name LIKE CONCAT('%',#{keywords},'%') OR locality LIKE CONCAT('%',#{keywords},'%') OR protein LIKE CONCAT('%',#{keywords},'%') OR oil LIKE CONCAT('%',#{keywords},'%') OR
            linoleic LIKE CONCAT('%',#{keywords},'%') OR linolenic LIKE CONCAT('%',#{keywords},'%') OR oleic LIKE CONCAT('%',#{keywords},'%') OR palmitic LIKE CONCAT('%',#{keywords},'%') OR
            stearic LIKE CONCAT('%',#{keywords},'%') OR height LIKE CONCAT('%',#{keywords},'%') OR flower_color LIKE CONCAT('%',#{keywords},'%') OR hilum_color LIKE CONCAT('%',#{keywords},'%') OR
            pod_color LIKE CONCAT('%',#{keywords},'%') OR pubescence_color LIKE CONCAT('%',#{keywords},'%') OR seed_coat_color LIKE CONCAT('%',#{keywords},'%') OR cotyledon_color LIKE CONCAT('%',#{keywords},'%') OR
            weight_per_100seeds LIKE CONCAT('%',#{keywords},'%') OR upper_leaflet_length LIKE CONCAT('%',#{keywords},'%') OR
            maturity_date LIKE CONCAT('%',#{keywords},'%') OR yield LIKE CONCAT('%',#{keywords},'%') OR category LIKE concat('%',#{group},'%')
            )
        </if>
        <if test="species!=null">
            AND species = #{species}
        </if>
        <if test="locality!=null">
            <choose>
                <when test="locality=='Other'">
                    AND locality NOT REGEXP 'China|United States|Japan|Korea|Brazil'
                </when>
                <otherwise>
                    AND locality LIKE CONCAT('%',#{locality},'%')
                </otherwise>
            </choose>
        </if>
        <if test="maturityDate!=null and maturityDate!=''">
            <choose>
                <when test="maturityDate!='0'.toString()">
                    AND maturity_date REGEXP CONCAT('^',#{maturityDate},' -')
                </when>
                <when test="maturityDate=='0'.toString()">
                    AND maturity_date like CONCAT('',#{maturityDate},'%')
                </when>
            </choose>
        </if>
        <if test="hilumColor!=null">
            AND hilum_color = #{hilumColor}
        </if>
        <if test="flowerColor!=null">
            AND flower_color = #{flowerColor}
        </if>
        <if test="podColor!=null">
            AND pod_color = #{podColor}
        </if>
        <if test="pubescenceColor!=null">
            AND pubescence_color =#{pubescenceColor}
        </if>
        <if test="seedCoatColor!=null">
            AND seed_coat_color =#{seedCoatColor}
        </if>
        <if test="cotyledonColor!=null">
            AND cotyledon_color = #{cotyledonColor}
        </if>
        <if test="protein_min!=null and protein_max!=null">
            AND (protein BETWEEN #{protein_min} AND #{protein_max})
        </if>
        <if test="oil_min!=null and oil_max!=null">
            AND (oil BETWEEN #{oil_min} AND #{oil_max})
        </if>
        <if test="linoleic_min!=null and linoleic_max!=null">
            AND (linoleic BETWEEN #{linoleic_min} AND #{linoleic_max})
        </if>
        <if test="linolenic_min!=null and linolenic_max!=null">
            AND (linolenic BETWEEN #{linolenic_min} AND #{linolenic_max})
        </if>
        <if test="oleic_min!=null and oleic_max!=null">
            AND (oleic BETWEEN #{oleic_min} AND #{oleic_max})
        </if>
        <if test="palmitic_min!=null and palmitic_max!=null">
            AND (palmitic BETWEEN #{palmitic_min} AND #{palmitic_max})
        </if>
        <if test="stearic_min!=null and stearic_max!=null">
            AND (stearic BETWEEN #{stearic_min} AND #{stearic_max})
        </if>
        <if test="height_min!=null and height_max!=null">
            AND (height BETWEEN #{height_min} AND #{height_max})
        </if>
        <if test="weightPer100seeds_min!=null and weightPer100seeds_max!=null">
            AND (weight_per_100seeds BETWEEN #{weightPer100seeds_min} AND #{weightPer100seeds_max})
        </if>
        <if test="upperLeafletLength_min!=null and upperLeafletLength_max!=null">
            AND (upper_leaflet_length BETWEEN #{upperLeafletLength_min} AND #{upperLeafletLength_max})
        </if>
        <if test="yield_min!=null and yield_max!=null">
            AND (yield BETWEEN #{yield_min} AND #{yield_max})
        </if>
        <if test="group!=null">
            AND category = #{group}
        </if>
        <if test="cultivar!=null">
            AND cultivar=#{cultivar}
        </if>
        <if test="sampleName!=null">
            AND sample_name=#{sampleName}
        </if>
    </select>-->
    <resultMap id="HandlerResultMap" type="com.gooalgene.dna.dto.SampleInfoDto" >
        <id column="id" property="id" jdbcType="INTEGER" />
        <result column="run_no" property="runNo" jdbcType="VARCHAR" typeHandler="com.gooalgene.dna.util.StringlToNullHandler" />
        <result column="scientific_name" property="scientificName" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="sample_id" property="sampleId" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="strain_name" property="strainName" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="preservation_location" property="preservationLocation" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="locality" property="locality" jdbcType="VARCHAR" typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="type" property="type" jdbcType="VARCHAR" typeHandler="com.gooalgene.dna.util.StringlToNullHandler" />
        <result column="environment" property="environment" jdbcType="VARCHAR" typeHandler="com.gooalgene.dna.util.StringlToNullHandler"  />
        <result column="materials" property="materials" jdbcType="VARCHAR" typeHandler="com.gooalgene.dna.util.StringlToNullHandler" />
        <result column="treat" property="treat" jdbcType="VARCHAR" typeHandler="com.gooalgene.dna.util.StringlToNullHandler"  />
        <result column="time" property="time" jdbcType="VARCHAR" typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="taxonomy" property="taxonomy" jdbcType="VARCHAR" typeHandler="com.gooalgene.dna.util.StringlToNullHandler" />
        <result column="mycelia_phenotype" property="myceliaPhenotype" jdbcType="VARCHAR" typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="mycelia_diameter" property="myceliaDiameter" jdbcType="VARCHAR" typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="mycelia_color" property="myceliaColor" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="spores_color" property="sporesColor" jdbcType="VARCHAR" typeHandler="com.gooalgene.dna.util.StringlToNullHandler" />
        <result column="spores_shape" property="sporesShape" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="clamp_connection" property="clampConnection" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="pileus_phenotype" property="pileusPhenotype" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="pileus_color" property="pileusColor" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="stipe_phenotype" property="stipePhenotype" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="stipe_color" property="stipeColor" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="fruitbody_color" property="fruitbodyColor" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>


        <result column="fruitbody_type" property="fruitbodyType" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="illumination" property="illumination" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="collarium" property="collarium" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="volva" property="volva" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="velum" property="velum" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="sclerotium" property="sclerotium" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="strain_medium" property="strainMedium" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="main_substrate" property="mainSubstrate" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="after_ripening_stage" property="afterRipeningStage" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="primordial_stimulation_fruitbody" property="primordialStimulationFruitbody" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="reproductive_mode" property="reproductiveMode" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="lifestyle" property="lifestyle" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="preservation" property="preservation" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="domestication" property="domestication" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="nuclearPhase" property="nuclearPhase" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
        <result column="matingType" property="matingType" jdbcType="VARCHAR"  typeHandler="com.gooalgene.dna.util.StringlToNullHandler"/>
    </resultMap>
    <select id="findListWithTypeHandler" resultMap="HandlerResultMap" parameterType="com.gooalgene.dna.dto.SampleInfoDto">
        SELECT * from dna_run
        WHERE 1=1
        <if test="keywords!=null">
            AND (
            run_no LIKE CONCAT('%',#{keywords},'%') OR scientific_name LIKE CONCAT('%',#{keywords},'%') OR sample_id LIKE CONCAT('%',#{keywords},'%')
            OR strain_name LIKE CONCAT('%',#{keywords},'%') OR
            preservation_location LIKE CONCAT('%',#{keywords},'%') OR locality LIKE CONCAT('%',#{keywords},'%') OR type LIKE CONCAT('%',#{keywords},'%')
            OR environment LIKE CONCAT('%',#{keywords},'%') OR
            materials LIKE CONCAT('%',#{keywords},'%') OR treat LIKE CONCAT('%',#{keywords},'%') OR time LIKE CONCAT('%',#{keywords},'%')
            OR taxonomy LIKE CONCAT('%',#{keywords},'%') OR
            mycelia_phenotype LIKE CONCAT('%',#{keywords},'%') OR mycelia_diameter LIKE CONCAT('%',#{keywords},'%') OR mycelia_color LIKE CONCAT('%',#{keywords},'%')
            OR spores_color LIKE CONCAT('%',#{keywords},'%') OR
            spores_shape LIKE CONCAT('%',#{keywords},'%') OR clamp_connection LIKE CONCAT('%',#{keywords},'%')
            OR pileus_phenotype LIKE CONCAT('%',#{keywords},'%') OR pileus_color LIKE CONCAT('%',#{keywords},'%') OR
            stipe_phenotype LIKE CONCAT('%',#{keywords},'%') OR stipe_color LIKE CONCAT('%',#{keywords},'%') OR
            fruitbody_color LIKE CONCAT('%',#{keywords},'%')
            OR fruitbody_type LIKE CONCAT('%',#{keywords},'%') OR illumination LIKE CONCAT('%',#{keywords},'%')
            OR collarium LIKE CONCAT('%',#{keywords},'%')
            OR volva LIKE CONCAT('%',#{keywords},'%')
            OR velum LIKE CONCAT('%',#{keywords},'%')
            OR sclerotium LIKE CONCAT('%',#{keywords},'%')
            OR strain_medium LIKE CONCAT('%',#{keywords},'%')
            OR main_substrate LIKE CONCAT('%',#{keywords},'%')
            OR after_ripening_stage LIKE CONCAT('%',#{keywords},'%')
            OR primordial_stimulation_fruitbody LIKE CONCAT('%',#{keywords},'%')
            OR reproductive_mode LIKE CONCAT('%',#{keywords},'%')
            OR lifestyle LIKE CONCAT('%',#{keywords},'%')
            OR preservation LIKE CONCAT('%',#{keywords},'%')
            OR domestication LIKE CONCAT('%',#{keywords},'%')
            OR nuclearPhase LIKE CONCAT('%',#{keywords},'%')
            OR matingType LIKE CONCAT('%',#{keywords},'%')
            )
        </if>
        <if test="scientificName!=null">
            AND scientific_name = #{scientificName}
        </if>
        <if test="sampleId!=null">
            AND sample_id = #{sampleId}
        </if>
        <if test="strainName!=null">
            AND strain_name = #{strainName}
        </if>
        <if test="locality!=null">
            <choose>
                <when test="locality=='Other'">
                    AND locality NOT REGEXP 'China|United States|Japan|Korea|Brazil'
                </when>
                <otherwise>
                    AND locality LIKE CONCAT('%',#{locality},'%')
                </otherwise>
            </choose>
        </if>
        <if test="preservationLocation!=null">
            AND preservation_location = #{preservationLocation}
        </if>
        <if test="type!=null">
            AND type = #{type}
        </if>
        <if test="environment!=null">
            AND environment =#{environment}
        </if>
        <if test="materials!=null">
            AND materials =#{materials}
        </if>
        <if test="treat!=null">
            AND treat = #{treat}
        </if>


        <if test="time!=null">
            AND time=#{time}
        </if>
        <if test="myceliaPhenotype!=null">
            AND mycelia_phenotype=#{myceliaPhenotype}
        </if>
        <if test="myceliaDiameter!=null">
            AND mycelia_diameter=#{myceliaDiameter}
        </if>
        <if test="myceliaColor!=null">
            AND mycelia_color=#{myceliaColor}
        </if>
        <if test="sporesColor!=null">
            AND spores_color=#{sporesColor}
        </if>
        <if test="sporesShape!=null">
            AND spores_shape=#{sporesShape}
        </if>
        <if test="clampConnection!=null">
            AND clamp_connection=#{clampConnection}
        </if>
        <if test="pileusPhenotype!=null">
            AND pileus_phenotype=#{pileusPhenotype}
        </if>
        <if test="pileusColor!=null">
            AND pileus_color=#{pileusColor}
        </if>
        <if test="stipePhenotype!=null">
            AND stipe_phenotype=#{stipePhenotype}
        </if>
        <if test="stipeColor!=null">
            AND stipe_color=#{stipeColor}
        </if>
        <if test="fruitbodyColor!=null">
            AND fruitbody_color=#{fruitbodyColor}
        </if>
        <if test="fruitbodyType!=null">
            AND fruitbody_type=#{fruitbodyType}
        </if>
        <if test="illumination!=null">
            AND illumination=#{illumination}
        </if>
        <if test="collarium!=null">
            AND collarium=#{collarium}
        </if>
        <if test="volva!=null">
            AND volva=#{volva}
        </if>
        <if test="velum!=null">
            AND velum=#{velum}
        </if>
        <if test="sclerotium!=null">
            AND sclerotium=#{sclerotium}
        </if>
        <if test="strainMedium!=null">
            AND strain_medium=#{strainMedium}
        </if>
        <if test="mainSubstrate!=null">
            AND main_substrate=#{mainSubstrate}
        </if>
        <if test="afterRipeningStage!=null">
            AND after_ripening_stage=#{afterRipeningStage}
        </if>
        <if test="primordialStimulationFruitbody!=null">
            AND primordial_stimulation_fruitbody=#{primordialStimulationFruitbody}
        </if>
        <if test="reproductiveMode!=null">
            AND reproductive_mode=#{reproductiveMode}
        </if>
        <if test="lifestyle!=null">
            AND lifestyle=#{lifestyle}
        </if>
        <if test="preservation!=null">
            AND preservation=#{preservation}
        </if>
        <if test="domestication!=null">
            AND domestication=#{domestication}
        </if>
        <if test="nuclearPhase!=null">
            AND nuclear_phase=#{nuclearPhase}
        </if>
        <if test="matingType!=null">
            AND mating_type=#{matingType}
        </if>
    </select>

    <update id="update" parameterType="com.gooalgene.dna.entity.DNARun">
        UPDATE `dna_run`
            SET
              `run_no` = #{runNo,jdbcType=VARCHAR},
              `species` = #{species,jdbcType=VARCHAR},
              `sample_name` = #{sampleName,jdbcType=VARCHAR},
              `cultivar` = #{cultivar,jdbcType=VARCHAR},
              `plant_name` = #{plantName,jdbcType=VARCHAR},
              `locality` = #{locality,jdbcType=VARCHAR},
              `protein` = #{protein,jdbcType=FLOAT},
              `oil` = #{oil,jdbcType=FLOAT},
              `linoleic` = #{linoleic,jdbcType=FLOAT},
              `linolenic` = #{linolenic,jdbcType=FLOAT},
              `oleic` = #{oleic,jdbcType=FLOAT},
              `palmitic` = #{palmitic,jdbcType=FLOAT},
              `stearic` = #{stearic,jdbcType=FLOAT},
              `height` = #{height,jdbcType=FLOAT},
              `flower_color` = #{flowerColor,jdbcType=VARCHAR},
              `hilum_color` = #{hilumColor,jdbcType=VARCHAR},
              `pod_color` = #{podColor,jdbcType=VARCHAR},
              `pubescence_color` = #{pubescenceColor,jdbcType=VARCHAR},
              `seed_coat_color` = #{seedCoatColor,jdbcType=VARCHAR},
              `cotyledon_color` = #{cotyledonColor,jdbcType=VARCHAR},
              `weight_per_100seeds` = #{weightPer100seeds},
              `upper_leaflet_length` = #{upperLeafletLength},
              `maturity_date` = #{maturityDate,jdbcType=VARCHAR},
              `yield` = #{yield,jdbcType=FLOAT},
              `category` = #{group,jdbcType=VARCHAR}
          WHERE `id` = #{id};
    </update>

    <select id="getByCultivar" resultMap="HandlerResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM dna_run WHERE replace(cultivar,' ','') IN
        <foreach collection="list" item="cultivar" open="(" close=")" separator=",">
            replace(#{cultivar},' ','')
        </foreach>
    </select>

    <select id="getByCultivarForExport" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM dna_run WHERE replace(cultivar,' ','') IN
        <foreach collection="list" item="cultivar" open="(" close=")" separator=",">
            replace(#{cultivar},' ','')
        </foreach>
    </select>

</mapper>