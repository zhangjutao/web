<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gooalgene.dna.dao.DNAGensDao">
    <select id="findDNAGensList" resultType="com.gooalgene.dna.entity.DNAGens">
        SELECT id,gene_id,gene_name,description as geneFunction
            FROM gens_baseinfo
            WHERE 1=1
        <if test="keywords != null">
            AND (gene_id LIKE concat('%', #{keywords},'%')
            OR gene_name LIKE concat('%', #{keywords},'%')
            OR description LIKE concat('%', #{keywords},'%'))
        </if>
    </select>

    <select id="findDNAGensInfoByGene" parameterType="String" resultType="com.gooalgene.dna.entity.DNAGens">
        SELECT * FROM dna_gens WHERE gene_id=#{geneId}
    </select>

    <select id="findById" parameterType="int" resultType="com.gooalgene.dna.entity.DNAGens">
        SELECT * FROM dna_gens WHERE id=#{id}
    </select>

    <insert id="add" parameterType="com.gooalgene.dna.entity.DNAGens">
        INSERT INTO dna_gens (gene_id, gene_name, gene_function) VALUES(#{geneId}, #{geneName}, #{geneFunction})
    </insert>

    <insert id="insertBatch">
        INSERT INTO `dna_gens`
        (`gene_id`,
        `gene_name`,
        `gene_function`,
        `gene_start`,
        `gene_end`)
        values
        <foreach collection="list" item="item" index="index" separator=",">
            (#{item.geneId,jdbcType=VARCHAR},
            #{item.geneName,jdbcType=VARCHAR},
            #{item.geneFunction,jdbcType=VARCHAR},
            #{item.geneStart,jdbcType=INTEGER},
            #{item.geneEnd,jdbcType=INTEGER})
        </foreach>
    </insert>

    <update id="update" parameterType="com.gooalgene.dna.entity.DNAGens">
        UPDATE dna_gens SET gene_id=#{geneId},gene_name=#{geneName},gene_function=#{geneFunction} WHERE id=#{id}
    </update>

    <update id="updateByGene" parameterType="com.gooalgene.dna.entity.DNAGens">
        UPDATE dna_gens SET gene_id=#{geneId},gene_name=#{geneName},gene_function=#{geneFunction} WHERE gene_id=#{geneId}
    </update>

    <update id="updateBatch" parameterType="java.util.List">
        UPDATE dna_gens
        SET gene_name = CASE gene_id
        <foreach collection="list" item="item">
            WHEN #{item.geneId} THEN #{item.geneName}
        </foreach>
        END
        ,gene_function = CASE gene_id
        <foreach collection="list" item="item">
            WHEN #{item.geneId} THEN #{item.geneFunction}
        </foreach>
        END
        WHERE
        geneId IN
        <foreach collection="list" item="item" open="(" separator="," close=")">
            #{item.geneId}
        </foreach>
    </update>

    <delete id="deleteById" parameterType="int">
        DELETE FROM dna_gens WHERE id=#{id}
    </delete>

    <delete id="deleteSpecificDNAGensInfo">
        DELETE FROM dna_gens WHERE LENGTH(geneName)>0 OR LENGTH(geneFunction)>0;
    </delete>

    <select id="getByRegion" resultType="string">
        SELECT gene_id FROM gens_baseinfo WHERE chromosome = #{chr} AND
        ((start <![CDATA[ <= ]]> #{start} AND end <![CDATA[ >= ]]> #{start}) OR
         (start <![CDATA[ <= ]]> #{end} AND end <![CDATA[ >= ]]> #{end})
         OR (start <![CDATA[ >= ]]> #{start} AND end <![CDATA[ <= ]]> #{end}))
    </select>

    <select id="findByGeneId" resultType="com.gooalgene.dna.entity.DNAGens">
        SELECT * FROM gens_baseinfo WHERE gene_id = #{0}
    </select>

</mapper>