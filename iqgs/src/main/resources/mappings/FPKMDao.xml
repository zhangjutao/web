<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gooalgene.iqgs.dao.FPKMDao">
    <resultMap id="advanceSearchResult" type="com.gooalgene.iqgs.entity.condition.AdvanceSearchResultView">
        <id property="id" column="id" javaType="int" jdbcType="INTEGER"/>
        <result property="geneId" column="gene_id" javaType="String" jdbcType="VARCHAR"/>
        <result property="geneOldId" column="gene_id_old" javaType="String" jdbcType="VARCHAR"/>
        <result property="podAll" column="pod_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="seedAll" column="seed_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="rootAll" column="root_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="shootAll" column="shoot_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="leafAll" column="leaf_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="seedlingAll" column="seedling_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="flowerAll" column="flower_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="stemAll" column="stem_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="geneName" column="gene_name" javaType="String" jdbcType="VARCHAR"/>
        <result property="functions" column="description" javaType="String" jdbcType="VARCHAR"/>
    </resultMap>

    <resultMap id="rangeSearchResult" type="com.gooalgene.iqgs.entity.condition.RangeSearchResult">
        <result property="geneId" column="gene_id" javaType="String" jdbcType="VARCHAR"/>
        <result property="podAll" column="pod_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="seedAll" column="seed_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="rootAll" column="root_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="shootAll" column="shoot_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="leafAll" column="leaf_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="seedlingAll" column="seedling_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="flowerAll" column="flower_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="stemAll" column="stem_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="geneName" column="gene_name" javaType="String" jdbcType="VARCHAR"/>
        <result property="description" column="description" javaType="String" jdbcType="VARCHAR"/>
        <result property="existsSNP" column="existsSNP" javaType="boolean" jdbcType="BOOLEAN" />
        <collection property="associateQTLs" column="qtl_name" ofType="String">
            <id column="gene_info_id" javaType="int" jdbcType="INTEGER" />
            <result column="qtl_name" javaType="String" jdbcType="VARCHAR" />
        </collection>
    </resultMap>

    <!-- 这里为什么要自定义一个GeneId字段,因为MyBatis一对多需要知道连接查询时ON的条件,根据该相等条件才能查询除多的那个字段并做映射 -->
    <resultMap id="qtlSearchResult" type="com.gooalgene.iqgs.entity.condition.RangeSearchResult">
        <result property="geneId" column="gene_id" javaType="String" jdbcType="VARCHAR"/>
        <result property="podAll" column="pod_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="seedAll" column="seed_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="rootAll" column="root_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="shootAll" column="shoot_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="leafAll" column="leaf_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="seedlingAll" column="seedling_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="flowerAll" column="flower_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="stemAll" column="stem_All" javaType="double" jdbcType="DOUBLE"/>
        <result property="geneName" column="gene_name" javaType="String" jdbcType="VARCHAR"/>
        <result property="description" column="description" javaType="String" jdbcType="VARCHAR"/>
        <result property="existsSNP" column="existsSNP" javaType="boolean" jdbcType="BOOLEAN" />
        <collection property="associateQTLs" column="qtl_name" ofType="String">
            <id column="geneId" javaType="String" jdbcType="VARCHAR" />
            <result column="qtl_name" javaType="String" jdbcType="VARCHAR" />
        </collection>
    </resultMap>

    <sql id="advanceSearchSQL">
        SELECT a.gene_id, a.pod_All, a.seed_All, a.root_All, a.shoot_All, a.leaf_All, a.seedling_All,
        a.flower_All, a.stem_All, f.id, f.gene_name, f.description,
        f.gene_id_old FROM fpkm a
        LEFT JOIN fpkm_associate_snp b ON a.id = b.fpkm_id
        LEFT JOIN snp_consequencetype c ON b.snp_id = c.id
        LEFT JOIN fpkm_associate_indel d ON a.id = d.fpkm_id
        LEFT JOIN indel_consequencetype e ON e.id = d.indel_id
        LEFT JOIN gens_baseinfo f ON a.gene_id = f.gene_id
        LEFT JOIN qtl_gene g ON f.id = g.gene_info_id
        LEFT JOIN associatedgenes h ON h.id = g.qtl_id
        LEFT JOIN gens_structure i ON i.gene_id = a.gene_id
        WHERE 1=1
        <include refid="geneExpressionCondition" />
        <if test="snp != null and snp.size() > 0">
            AND c.consequencetype IN
            <foreach collection="snp" index="index" item="item" open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        <if test="indel != null and indel.size() > 0">
            AND e.consequencetype IN
            <foreach collection="indel" index="index" item="item" open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
        <if test="qtl != null and qtl.size() > 0">
            AND h.id IN
            <foreach collection="qtl" index="index" item="item" open="(" close=")" separator=",">
                #{item}
            </foreach>
        </if>
    </sql>
    <!-- 基因表达量选择条件公共部分,每个高级搜索都有可能传入该参数 -->
    <sql id="geneExpressionCondition">
        <if test="geneExpression != null and geneExpression.size() > 0">
            AND (
            <trim suffixOverrides="OR">
                <foreach collection="geneExpression" index="index" item="item">
                    <if test="item.tissue.pod != null">
                        a.pod BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.endosperm != null">
                        a.endosperm BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.seed != null">
                        a.seed BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.embryo != null">
                        a.embryo BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.axis != null">
                        a.axis BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.cotyledon != null">
                        a.cotyledon BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.seedCoat != null">
                        a.seed_coat BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.nodule != null">
                        a.nodule BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.rootHair != null">
                        a.root_hair BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.root != null">
                        a.root BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.rootTip != null">
                        a.root_tip BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.shoot != null">
                        a.shoot BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.shootTip != null">
                        a.shoot_tip BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.shootApicalMeristem != null">
                        a.shoot_apical_meristem BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.shootMeristem != null">
                        a.shoot_meristem BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.primaryleaf != null">
                        a.primaryleaf BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.petiole != null">
                        a.petiole BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.leaf != null">
                        a.leaf BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.trifoliate != null">
                        a.trifoliate BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.leafbud != null">
                        a.leafbud BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.leaflet != null">
                        a.leaflet BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.cotyledonsOfSeedling != null">
                        a.cotyledons_of_seedling BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.seedling != null">
                        a.seedling BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.flowerBud != null">
                        a.flower_bud BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.flower != null">
                        a.flower BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.stem != null">
                        a.stem BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.stemInternode != null">
                        a.stem_internode BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.hypocotyl != null">
                        a.hypocotyl BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                </foreach>
            </trim>
            )
        </if>
    </sql>
    <sql id="groupBySQL">
        GROUP BY a.id, a.gene_id, a.pod_All, a.seed_All, a.root_All, a.shoot_All, a.leaf_All, a.seedling_All, a.flower_All,
        a.stem_All, f.id, f.gene_id_old, f.gene_name, f.description
    </sql>

    <select id="findGeneThroughGeneExpressionCondition"
            parameterType="com.gooalgene.iqgs.entity.condition.GeneExpressionConditionEntity"
            resultMap="advanceSearchResult">
        <include refid="advanceSearchSQL"/>
        <if test="firstHierarchyQtlId != null and firstHierarchyQtlId.size() > 0">
            AND f.id IN
            (SELECT a.id FROM gens_baseinfo a
            LEFT JOIN qtl_gene b ON a.id = b.gene_info_id
            LEFT JOIN associatedgenes c ON c.id = b.qtl_id
            WHERE c.id in
            <foreach collection="firstHierarchyQtlId" index="index" item="item" open="(" close=")" separator=",">
                #{item}
            </foreach>
            )
        </if>
        <if test="searchById != null">
            <if test="searchById.geneId != null">
                AND (f.gene_id LIKE CONCAT('%', #{searchById.geneId}, '%') OR f.gene_id_old LIKE CONCAT('%',
                #{searchById.geneId}, '%'))
            </if>
            <if test="searchById.geneName != null">
                AND f.gene_name LIKE CONCAT('%', #{searchById.geneName}, '%')
            </if>
            <if test="searchById.functions != null">
                AND f.description LIKE CONCAT('%', #{searchById.functions}, '%')
            </if>
        </if>
        <if test="structure != null">
            AND i.chromosome = #{structure.chromosome} AND (
            (i.start &gt;#{structure.start} AND i.start &lt;#{structure.end})
            OR
            (i.end &gt;#{structure.start} AND i.end &lt;#{structure.end})
            OR
            (i.start &lt;#{structure.start} AND i.end &gt;#{structure.start})
            )
        </if>
        <include refid="groupBySQL"/>
    </select>

    <select id="fetchFirstHundredGene"
            parameterType="com.gooalgene.iqgs.entity.condition.GeneExpressionConditionEntity"
            resultMap="advanceSearchResult">
        <include refid="advanceSearchSQL"/>
        <if test="geneId != null and geneId.size() > 0">
            AND f.id IN
            <foreach collection="geneId" index="index" item="item" separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        <include refid="groupBySQL"/>
    </select>

    <select id="searchByRegion" resultMap="rangeSearchResult">
        SELECT
        a.*,
        g.gene_info_id,
        g.qtl_name
        FROM (
        SELECT
        a.id,
        a.gene_id,
        a.pod_All,
        a.seed_All,
        a.root_All,
        a.shoot_All,
        a.leaf_All,
        a.seedling_All,
        a.flower_All,
        a.stem_All,
        CASE WHEN b.fpkm_id IS NULL
        THEN FALSE
        ELSE TRUE END AS existSNP,
        f.gene_name,
        f.description,
        f.gene_id_old
        FROM fpkm a LEFT JOIN (SELECT fpkm_id
        FROM fpkm_associate_snp
        WHERE snp_id = 12) AS b ON a.id = b.fpkm_id
        JOIN
          (SELECT * FROM gens_baseinfo
            WHERE
          chromosome = #{0} AND ((start  <![CDATA[ >= ]]> #{1} AND start <![CDATA[ < ]]> #{2})
          OR (end <![CDATA[ >= ]]> #{1} AND end <![CDATA[ < ]]> #{2}) OR (start <![CDATA[ <= ]]> #{1} AND end <![CDATA[ > ]]> #{1}))) AS f
          ON a.baseinfo_id = f.id LIMIT #{3}, #{4}) AS a
        LEFT JOIN qtl_gene g ON g.gene_info_id = a.id;
    </select>

    <select id="countBySearchRegion" resultType="int">
        SELECT COUNT(*) AS total FROM
        (SELECT
        a.gene_id,
        a.pod_All,
        a.seed_All,
        a.root_All,
        a.shoot_All,
        a.leaf_All,
        a.seedling_All,
        a.flower_All,
        a.stem_All,
        CASE WHEN b.fpkm_id IS NULL THEN FALSE ELSE TRUE END AS existSNP,
        f.id,
        f.gene_name,
        f.description,
        f.gene_id_old
        FROM fpkm a
        LEFT JOIN (SELECT fpkm_id FROM fpkm_associate_snp WHERE snp_id = 12) AS b ON a.id = b.fpkm_id
        JOIN (SELECT * FROM gens_baseinfo WHERE chromosome = #{0} AND ((start  <![CDATA[ >= ]]> #{1} AND start <![CDATA[ < ]]> #{2})
            OR (end <![CDATA[ >= ]]> #{1} AND end <![CDATA[ < ]]> #{2}) OR (start <![CDATA[ <= ]]> #{1} AND end <![CDATA[ > ]]> #{1}))) AS f
        ON a.baseinfo_id = f.id) AS result
    </select>

    <select id="findViewByQtl" resultMap="qtlSearchResult">
        SELECT
          a.gene_id,
          a.qtl_name,
          b.geneId,
          c.gene_name,
          c.description,
          c.gene_id_old,
          d.pod_All,
          d.seed_All,
          d.root_All,
          d.shoot_All,
          d.leaf_All,
          d.seedling_All,
          d.flower_All,
          d.stem_All,
          CASE WHEN e.fpkm_id IS NULL
            THEN FALSE
          ELSE TRUE END AS existSNP
        FROM qtl_gene a
        JOIN (
          SELECT gene_id AS geneId FROM qtl_gene a
            WHERE a.qtl_id IN
            <foreach collection="qtl" item="item" separator="," open="(" close=")">
                #{item}
            </foreach>
        LIMIT #{1}, #{2}) AS b ON b.geneId = a.gene_id
        LEFT JOIN gens_baseinfo c ON c.id = a.gene_info_id
        LEFT JOIN fpkm d ON c.id = d.baseinfo_id
        LEFT JOIN (SELECT fpkm_id
                   FROM fpkm_associate_snp
                   WHERE snp_id = 12) AS e ON d.id = e.fpkm_id;
    </select>

    <select id="advanceSearchByQtl" resultMap="qtlSearchResult">
        SELECT
         a.gene_id,
         a.qtl_name,
         b.geneId,
         c.gene_name,
         c.description,
         c.gene_id_old,
         d.pod_All,
         d.seed_All,
         d.root_All,
         d.shoot_All,
         d.leaf_All,
         d.seedling_All,
         d.flower_All,
         d.stem_All,
         CASE WHEN e.fpkm_id IS NULL
           THEN FALSE
         ELSE TRUE END AS existSNP
       FROM qtl_gene a
         JOIN (SELECT gene_id AS geneId
               FROM qtl_gene a
               WHERE a.qtl_id IN
                <foreach collection="firstHierarchyQtlId" item="item" separator="," open="(" close=")">
                    #{item}
                </foreach>
               ) AS b ON b.geneId = a.gene_id
         JOIN (SELECT gene_id AS secondQtlId
               FROM qtl_gene a
               WHERE a.qtl_id IN
                <foreach collection="qtl" item="item" separator="," open="(" close=")">
                    #{item}
                </foreach>
               ) AS h ON h.secondQtlId = a.gene_id
         LEFT JOIN gens_baseinfo c ON c.id = a.gene_info_id
         JOIN (SELECT id, baseinfo_id, pod_All, seed_All, root_All, shoot_All, leaf_All, seedling_All, flower_All, stem_All FROM fpkm
              WHERE 1 = 1
              <include refid="geneExpressionCondition" />
              ) AS d ON c.id = d.baseinfo_id
         JOIN (SELECT fpkm_id FROM fpkm_associate_snp WHERE snp_id IN
                <foreach collection="snp" item="item" separator="," open="(" close=")">
                    #{item}
                </foreach>
              ) AS f ON d.id = f.fpkm_id
         JOIN (SELECT fpkm_id FROM fpkm_associate_indel WHERE indel_id IN
                <foreach collection="indel" item="item" separator="," open="(" close=")">
                    #{item}
                </foreach>
              ) AS g ON d.id = g.fpkm_id
         LEFT JOIN (SELECT fpkm_id
                    FROM fpkm_associate_snp
                    WHERE snp_id = 12) AS e ON d.id = e.fpkm_id
    </select>

    <select id="countAdvanceSearchByQtl" resultType="int">
        SELECT count(*) AS result FROM (
        SELECT DISTINCT a.gene_id AS geneId
        FROM qtl_gene a
          JOIN (SELECT gene_id AS secondQtlId
                FROM qtl_gene a
                WHERE a.qtl_id IN
                <foreach collection="qtl" item="item" separator="," open="(" close=")">
                    #{item}
                </foreach>
                ) AS b ON a.gene_id = b.secondQtlId
          LEFT JOIN gens_baseinfo c ON c.id = a.gene_info_id
          JOIN (SELECT id, baseinfo_id, pod_All, seed_All, root_All, shoot_All, leaf_All, seedling_All, flower_All, stem_All FROM fpkm a
                WHERE 1 = 1
                <include refid="geneExpressionCondition" />
                ) AS d ON c.id = d.baseinfo_id
          JOIN (SELECT fpkm_id FROM fpkm_associate_snp WHERE snp_id IN
                <foreach collection="snp" item="item" separator="," open="(" close=")">
                    #{item}
                </foreach>
                ) AS f ON d.id = f.fpkm_id
          JOIN (SELECT fpkm_id FROM fpkm_associate_indel WHERE indel_id IN
                <foreach collection="indel" item="item" separator="," open="(" close=")">
                    #{item}
                </foreach>
                ) AS g ON d.id = g.fpkm_id
        WHERE a.qtl_id IN
          <foreach collection="firstHierarchyQtlId" item="item" separator="," open="(" close=")">
              #{item}
          </foreach>
        ) AS table_count
    </select>

    <select id="countBySearchQtl" parameterType="int" resultType="int">
        SELECT COUNT(gene_id) AS geneId FROM qtl_gene a
        WHERE a.qtl_id IN
        <foreach collection="qtl" item="item" separator="," open="(" close=")">
            #{item}
        </foreach>
    </select>

    <select id="advanceSearchByGeneId"
            parameterType="com.gooalgene.iqgs.entity.condition.GeneExpressionConditionEntity"
            resultMap="advanceSearchResult">
        SELECT
            a.gene_id,
            a.pod_All,
            a.seed_All,
            a.root_All,
            a.shoot_All,
            a.leaf_All,
            a.seedling_All,
            a.flower_All,
            a.stem_All,
            f.id,
            f.gene_name,
            f.description,
            f.gene_id_old
        FROM fpkm a LEFT JOIN fpkm_associate_snp b ON a.id = b.fpkm_id
            JOIN (SELECT a.id FROM snp_consequencetype a WHERE a.consequencetype IN ('UTR3', 'exonic_nonsynonymous SNV')) AS c ON b.snp_id = c.id
            JOIN (SELECT * FROM gens_baseinfo a WHERE a.gene_id LIKE concat('%', #{geneId}, '%') OR a.gene_id_old LIKE concat('%', #{geneId}, '%') AS f ON a.gene_id = f.gene_id
        WHERE 1 = 1
        <if test="geneExpression != null and geneExpression.size() > 0">
            AND (
            <trim suffixOverrides="OR">
                <foreach collection="geneExpression" index="index" item="item">
                    <if test="item.tissue.pod != null">
                        a.pod BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.endosperm != null">
                        a.endosperm BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.seed != null">
                        a.seed BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.embryo != null">
                        a.embryo BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.axis != null">
                        a.axis BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.cotyledon != null">
                        a.cotyledon BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.seedCoat != null">
                        a.seed_coat BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.nodule != null">
                        a.nodule BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.rootHair != null">
                        a.root_hair BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.root != null">
                        a.root BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.rootTip != null">
                        a.root_tip BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.shoot != null">
                        a.shoot BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.shootTip != null">
                        a.shoot_tip BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.shootApicalMeristem != null">
                        a.shoot_apical_meristem BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.shootMeristem != null">
                        a.shoot_meristem BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.primaryleaf != null">
                        a.primaryleaf BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.petiole != null">
                        a.petiole BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.leaf != null">
                        a.leaf BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.trifoliate != null">
                        a.trifoliate BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.leafbud != null">
                        a.leafbud BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.leaflet != null">
                        a.leaflet BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.cotyledonsOfSeedling != null">
                        a.cotyledons_of_seedling BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.seedling != null">
                        a.seedling BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.flowerBud != null">
                        a.flower_bud BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.flower != null">
                        a.flower BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.stem != null">
                        a.stem BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.stemInternode != null">
                        a.stem_internode BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                    <if test="item.tissue.hypocotyl != null">
                        a.hypocotyl BETWEEN #{item.begin} AND #{item.end} OR
                    </if>
                </foreach>
            </trim>
            )
        </if>
    </select>

    <select id="fetchFirstHundredGeneInGeneStructure"
            resultMap="advanceSearchResult">
        <include refid="advanceSearchSQL"/>
        <if test="structureId != null and structureId.size() > 0">
            AND i.id IN
            <foreach collection="structureId" index="index" item="item" separator="," open="(" close=")">
                #{item.id}
            </foreach>
        </if>
        <include refid="groupBySQL"/>
    </select>

    <select id="checkExistSNP" resultType="boolean">
        SELECT exists(SELECT c.consequencetype
                      FROM fpkm a
                          LEFT JOIN fpkm_associate_snp b ON a.id = b.fpkm_id
                          LEFT JOIN snp_consequencetype c ON c.id = b.snp_id
                      WHERE a.gene_id = #{0} AND c.consequencetype = #{1}) AS result;
    </select>


    <select id="getFieldsFromFpkmForSort" resultType="com.gooalgene.iqgs.entity.GeneFPKM">
        SELECT gene_id,
        <if test="fields!=null and fields!=''">
            ${fields}
        </if>
        from fpkm
        <where>
            <if test="geneIds!=null and geneIds.size>0">
                gene_id in
                <foreach collection="geneIds" item="geneId" open="(" close=")" separator=",">
                    #{geneId}
                </foreach>
            </if>
        </where>
    </select>

    <select id="getAllConsequenceTypeAndItsId" resultType="java.util.Map">
        <if test="type == 'SNP'">
            SELECT consequencetype, id FROM snp_consequencetype
        </if>
        <if test="type == 'INDEL'">
            SELECT consequencetype, id FROM indel_consequencetype
        </if>
    </select>

</mapper>